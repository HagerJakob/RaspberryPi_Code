<!DOCTYPE html>
<html lang="de" class="bg-black">
<head>
<meta charset="UTF-8" />
<title>Racing Dashboard</title>

<!-- TailwindCSS CDN -->
<script src="https://cdn.tailwindcss.com"></script>

<!-- SocketIO -->
<script src="https://cdn.socket.io/4.6.1/socket.io.min.js"></script>

<style>
    /* Carbon Background */
    .carbon {
        background:
            repeating-linear-gradient(45deg, #0d0d0d 0 4px, #111 4px 8px);
    }

    canvas {
        image-rendering: optimizeSpeed;
        image-rendering: crisp-edges;
    }

    /* Neon Glow */
    .neon-text {
        text-shadow: 0 0 12px rgba(0,255,255,0.7);
    }

    .rpm-glow {
        filter: drop-shadow(0 0 12px #d64cff);
    }
</style>
</head>

<body class="w-full h-full flex justify-center items-center">

<div id="wrap"
    class="carbon w-[1280px] h-[400px] rounded-3xl shadow-xl relative overflow-hidden border border-gray-700">

    <!-- Canvas Gauge -->
    <canvas id="gauge" width="1280" height="400"></canvas>

    <!-- Left Info Boxes -->
    <div class="absolute left-10 top-10 flex flex-col gap-6 text-white">
        <div>
            <div class="text-gray-300 text-sm">OIL TEMP</div>
            <div id="oil" class="text-cyan-400 neon-text text-2xl">60</div>
        </div>
        <div>
            <div class="text-gray-300 text-sm">FUEL</div>
            <div id="fuel" class="text-cyan-400 neon-text text-2xl">73%</div>
        </div>
        <div>
            <div class="text-gray-300 text-sm">COOLANT</div>
            <div id="temp" class="text-cyan-400 neon-text text-2xl">20°C</div>
        </div>
    </div>

    <!-- Right Info Boxes -->
    <div class="absolute right-10 top-10 flex flex-col gap-6 text-white">
        <div>
            <div class="text-gray-300 text-sm">BATTERY</div>
            <div id="voltage" class="text-cyan-400 neon-text text-2xl">12.1V</div>
        </div>
        <div>
            <div class="text-gray-300 text-sm">BOOST</div>
            <div id="boost" class="text-cyan-400 neon-text text-2xl">1.1 bar</div>
        </div>
        <div>
            <div class="text-gray-300 text-sm">OIL PRESS</div>
            <div id="oilpress" class="text-cyan-400 neon-text text-2xl">0.3 bar</div>
        </div>
    </div>

</div>

<script>
let speed=0, rpm=0;

// Canvas Setup
const c = document.getElementById("gauge");
const ctx = c.getContext("2d");
const cx=640, cy=380;
const rOuter=340;   // großer Bogen (RPM)
const rInner=260;   // Zeigerlänge

const start=Math.PI*1.1, end=Math.PI*1.9;


// -----------------------------
// RPM SKALA (oben, außen)
// -----------------------------
function drawRpmScale() {
    ctx.save();
    ctx.lineWidth = 3;
    ctx.strokeStyle = "rgba(255,255,255,0.45)";
    ctx.fillStyle = "white";
    ctx.font = "17px Courier New";
    ctx.textAlign = "center";

    for (let i=0; i<=10; i++) {
        let a = start + (end-start)*(i/10);

        // Tick außen
        let x1 = cx + Math.cos(a)*(rOuter+5);
        let y1 = cy + Math.sin(a)*(rOuter+5);

        let x2 = cx + Math.cos(a)*(rOuter-35);
        let y2 = cy + Math.sin(a)*(rOuter-35);

        ctx.beginPath();
        ctx.moveTo(x1,y1);
        ctx.lineTo(x2,y2);
        ctx.stroke();

        // RPM-Zahl (weit oben)
        ctx.fillText(
            i*1000,
            cx + Math.cos(a)*(rOuter+35),
            cy + Math.sin(a)*(rOuter+35)
        );
    }

    ctx.restore();
}


// -----------------------------
// SPEED SKALA (unten, innen)
// -----------------------------
function drawSpeedScale() {
    ctx.save();
    ctx.lineWidth = 3;
    ctx.strokeStyle = "rgba(255,255,255,0.45)";
    ctx.fillStyle = "white";
    ctx.font = "16px Courier New";
    ctx.textAlign = "center";

    // 0 – 255 → 17 Schritte → ~15er Steps
    for (let i=0; i<=17; i++) {
        let p = i / 17;
        let a = start + (end-start)*p;
        let val = Math.round(p * 255);

        // Tick näher am Zeiger (deutlich weiter innen als RPM Skala)
        let x1 = cx + Math.cos(a)*(rInner+10);
        let y1 = cy + Math.sin(a)*(rInner+10);

        let x2 = cx + Math.cos(a)*(rInner+40);
        let y2 = cy + Math.sin(a)*(rInner+40);

        ctx.beginPath();
        ctx.moveTo(x1,y1);
        ctx.lineTo(x2,y2);
        ctx.stroke();

        // Speed Zahl unterhalb des Ticks
        ctx.fillText(
            val,
            cx + Math.cos(a)*(rInner+70),
            cy + Math.sin(a)*(rInner+70)
        );
    }

    ctx.restore();
}



// -----------------------------
// Hauptanzeige
// -----------------------------
function drawGauge(){
    ctx.clearRect(0,0,c.width,c.height);

    // Skalen zeichnen
    drawRpmScale();
    drawSpeedScale();

    // Grauer Bogen
    ctx.beginPath();
    ctx.arc(cx, cy, rOuter, start, end);
    ctx.strokeStyle="rgba(140,140,160,0.2)";
    ctx.lineWidth=45;
    ctx.stroke();

    // RPM Balken
    let p = Math.min(rpm/10000,1);
    let rpmEnd = start + (end-start)*p;

    ctx.beginPath();
    ctx.arc(cx, cy, rOuter, start, rpmEnd);
    ctx.strokeStyle="#d64cff";
    ctx.lineWidth=45;
    ctx.stroke();
    
    // Speed Zeiger
    let sp = Math.min(speed/255,1);
    let ang = start + (end-start)*sp;

    ctx.beginPath();
    ctx.moveTo(cx, cy);
    ctx.lineTo(cx + Math.cos(ang)*rInner, cy + Math.sin(ang)*rInner);
    ctx.strokeStyle="white";
    ctx.lineWidth=6;
    ctx.stroke();

    // Speed Zahl (groß)
    ctx.font="120px Courier New";
    ctx.textAlign="center";
    ctx.textBaseline="middle";
    ctx.fillStyle="cyan";
    ctx.fillText(speed, cx, cy-150);
}



// -----------------------------
// Live Updates via Socket.IO
// -----------------------------
const socket = io();

socket.on('update', data => {
    if(data.RPM!==undefined) rpm = parseInt(data.RPM);
    if(data.SPEED!==undefined) speed = parseInt(data.SPEED);
    drawGauge();
});

// Initial anzeigen
drawGauge();
</script>



</body>
</html>

<!DOCTYPE html>
<html lang="de" class="bg-black">
<head>
<meta charset="UTF-8" />
<title>Racing Dashboard</title>

<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.socket.io/4.6.1/socket.io.min.js"></script>

<style>
/* Pechschwarzer Hintergrund, komplett clean */
.carbon {
    background-color: #000; /* pechschwarz */
    position: relative;
}

/* Canvas */
canvas {
    image-rendering: optimizeSpeed;
    image-rendering: crisp-edges;
}

/* Neon Glow Text */
.neon-text {
    text-shadow: 0 0 8px rgba(0,255,255,0.7),
                 0 0 16px rgba(0,255,255,0.5),
                 0 0 24px rgba(0,255,255,0.3);
}

/* Side Boxes Styling */
.side-box {
    margin-top: 10px;
    background: rgba(0,0,0,0.55);
    border-left: 4px solid #0ff;
    border-top: 4px solid #0ff;
    border-radius: 16px;
    padding: 14px 18px;
    display: flex;
    flex-direction: column;
    justify-content: space-around;
    height: 90%;
    backdrop-filter: blur(6px);
    box-shadow: 0 0 12px rgba(0,255,255,0.2);
}

.value-glow:hover {
    text-shadow: 0 0 12px #0ff,
                 0 0 24px #0ff;
    transform: scale(1.05);
    transition: all 0.2s ease-in-out;
}

.shift-arrow {
    position: absolute; /* statt fixed */
    font-size: 4rem;
    font-weight: bold;
    text-align: center;
    z-index: 10;
    user-select: none;
}

/* Downshift links außen */
#downshift {
    left: -60px;   /* außerhalb der Box, aber innerhalb des Dashboards */
    top: 30%;      /* etwas höher */
    color: red;
    display: none;
}

/* Upshift rechts außen */
#upshift {
    right: -60px;  /* außerhalb der Box, aber innerhalb des Dashboards */
    top: 30%;      /* etwas höher */
    color: lime;
    display: none;
}

</style>

</head>

<body class="w-full h-full flex justify-center items-center">

<!-- Shift Pfeile außerhalb des Dashboards -->
<div id="downshift" class="shift-arrow">⬇</div>
<div id="upshift" class="shift-arrow">⬆</div>

<div id="wrap" class="carbon w-[1280px] h-[400px] rounded-3xl shadow-2xl relative border border-gray-800 flex">

   <!-- Left Info Boxes -->
    <div class="absolute left-4 top-2 bottom-2 flex flex-col justify-between side-box text-white">
        <div>
            <div class="text-gray-400 text-xs tracking-widest">OIL TEMP</div>
            <div id="oil" class="text-cyan-400 neon-text text-2xl font-bold value-glow">60°C</div>
        </div>
        <div>
            <div class="text-gray-400 text-xs tracking-widest">FUEL</div>
            <div id="fuel" class="text-cyan-400 neon-text text-2xl font-bold value-glow">73%</div>
        </div>
        <div>
            <div class="text-gray-400 text-xs tracking-widest">COOLANT</div>
            <div id="temp" class="text-cyan-400 neon-text text-2xl font-bold value-glow">20°C</div>
        </div>
    </div>

    <!-- Right Info Boxes -->
    <div class="absolute right-4 top-2 bottom-2 flex flex-col justify-between side-box text-white">
        <div>
            <div class="text-gray-400 text-xs tracking-widest">BATTERY</div>
            <div id="voltage" class="text-cyan-400 neon-text text-2xl font-bold value-glow">12.1V</div>
        </div>
        <div>
            <div class="text-gray-400 text-xs tracking-widest">BOOST</div>
            <div id="boost" class="text-cyan-400 neon-text text-2xl font-bold value-glow">1.1 bar</div>
        </div>
        <div>
            <div class="text-gray-400 text-xs tracking-widest">OIL PRESS</div>
            <div id="oilpress" class="text-cyan-400 neon-text text-2xl font-bold value-glow">0.3 bar</div>
        </div>
    </div>

    <!-- Canvas Gauge -->
    <canvas id="gauge" width="1280" height="400" class="absolute left-0 top-0"></canvas>

</div>
<script>
let speed=0, rpm=0;

// Canvas Setup
const c = document.getElementById("gauge");
const ctx = c.getContext("2d");
const cx=640, cy=390;
const rOuter=320;   // großer Bogen (RPM)
const rInner=250;   // Zeigerlänge
const start=Math.PI*1.05, end=Math.PI*1.95;

// -----------------------------
// RPM Gradient einmal erstellen
// -----------------------------
const rpmGrad = ctx.createLinearGradient(cx-rOuter, cy-rOuter, cx+rOuter, cy+rOuter);
rpmGrad.addColorStop(0, "#ff00ff");
rpmGrad.addColorStop(0.5, "#d64cff");
rpmGrad.addColorStop(1, "#ff00ff");

// -----------------------------
// RPM SKALA (oben, außen)
// -----------------------------
function drawRpmScale() {
    ctx.save();
    ctx.lineWidth = 3;
    ctx.strokeStyle = "rgba(255,255,255,0.45)";
    ctx.fillStyle = "white";
    ctx.font = "17px Courier New";
    ctx.textAlign = "center";

    // nur bis 8k RPM
    for (let i=0; i<=8; i++) {
        let a = start + (end-start)*(i/8);

        // Tick außen
        let x1 = cx + Math.cos(a)*(rOuter+15);
        let y1 = cy + Math.sin(a)*(rOuter+15);

        let x2 = cx + Math.cos(a)*(rOuter+40);
        let y2 = cy + Math.sin(a)*(rOuter+40);

        ctx.beginPath();
        ctx.moveTo(x1,y1);
        ctx.lineTo(x2,y2);
        ctx.stroke();

        // RPM-Zahl
        ctx.fillText(i, cx + Math.cos(a)*(rOuter+50), cy + Math.sin(a)*(rOuter+50));
    }

    ctx.restore();
}

// -----------------------------
// SPEED SKALA (unten, innen)
// -----------------------------
function drawSpeedScale() {
    ctx.save();
    ctx.lineWidth = 3;
    ctx.strokeStyle = "rgba(255,255,255,0.45)";
    ctx.fillStyle = "white";
    ctx.font = "16px Courier New";
    ctx.textAlign = "center";

    for (let i=0; i<=17; i++) {
        let p = i / 17;
        let a = start + (end-start)*p;
        let val = Math.round(p * 255);

        let x1 = cx + Math.cos(a)*(rInner+55);
        let y1 = cy + Math.sin(a)*(rInner+55);

        let x2 = cx + Math.cos(a)*(rInner+30);
        let y2 = cy + Math.sin(a)*(rInner+30);

        ctx.beginPath();
        ctx.moveTo(x1,y1);
        ctx.lineTo(x2,y2);
        ctx.stroke();

        ctx.fillText(val, cx + Math.cos(a)*(rInner + 11), cy + Math.sin(a)*(rInner + 11));
    }

    ctx.restore();
}

// -----------------------------
// Hauptanzeige
// -----------------------------
function drawGauge(){
    ctx.clearRect(0,0,c.width,c.height);

    drawRpmScale();
    drawSpeedScale();

    // Grauer Bogen
    ctx.beginPath();
    ctx.arc(cx, cy, rOuter, start, end);
    ctx.strokeStyle="rgba(140,140,160,0.2)";
    ctx.lineWidth=45;
    ctx.stroke();

    // RPM Balken
    let p = Math.min(rpm/8000,1); // jetzt max 8k
    let rpmEnd = start + (end-start)*p;

    ctx.save();
    ctx.strokeStyle = rpmGrad;
    ctx.lineWidth = 45;

    // Glow entfernen
    ctx.shadowBlur = 0;

    ctx.beginPath();
    ctx.arc(cx, cy, rOuter, start, rpmEnd);
    ctx.stroke();
    ctx.restore();


    // Speed Zeiger
    let sp = Math.min(speed/255,1);
    let ang = start + (end-start)*sp;

    ctx.beginPath();
    ctx.moveTo(cx, cy);
    ctx.lineTo(cx + Math.cos(ang)*rInner, cy + Math.sin(ang)*rInner);
    ctx.strokeStyle="white";
    ctx.lineWidth=3;
    ctx.stroke();

    // Speed Zahl (groß)
    ctx.font = "small-caps 120px 'Verdana'";
    ctx.textAlign="center";
    ctx.textBaseline="middle";
    ctx.fillStyle="cyan";
    ctx.fillText(speed, cx, cy-140);
}

// -----------------------------
// Live Updates via Socket.IO
// -----------------------------
const socket = io();

socket.on('update', data => {
    if(data.RPM !== undefined) rpm = parseInt(data.RPM);
    if(data.SPEED !== undefined) speed = parseInt(data.SPEED);
    if(data.COOLANT !== undefined) document.getElementById("temp").textContent = data.COOLANT;

    // Downshift links (RPM < 1000)
    if(rpm < 1000){
        document.getElementById("downshift").style.display = "block";
    } else {
        document.getElementById("downshift").style.display = "none";
    }

    // Upshift rechts (RPM > 6000)
    if(rpm > 6000){
        document.getElementById("upshift").style.display = "block";
    } else {
        document.getElementById("upshift").style.display = "none";
    }

    drawGauge();
});


// Initial anzeigen
drawGauge();
</script>

</body>
</html>

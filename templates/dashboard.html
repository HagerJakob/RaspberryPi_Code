<!DOCTYPE html>
<html lang="de" class="bg-black">
<head>
<meta charset="UTF-8" />
<title>Racing Dashboard</title>

<!-- TailwindCSS CDN -->
<script src="https://cdn.tailwindcss.com"></script>

<!-- SocketIO -->
<script src="https://cdn.socket.io/4.6.1/socket.io.min.js"></script>

<style>
/* Pechschwarzer Hintergrund */
.carbon {
    background-color: #000; /* pechschwarz */
    position: relative;
    overflow: hidden;
}

canvas {
    image-rendering: optimizeSpeed;
    image-rendering: crisp-edges;
}

/* Neon Glow Text */
.neon-text {
    text-shadow: 0 0 8px rgba(0,255,255,0.7),
                 0 0 16px rgba(0,255,255,0.5),
                 0 0 24px rgba(0,255,255,0.3);
}

/* Side Boxes Styling */
.side-box {
    background: rgba(0,0,0,0.55);
    border-left: 4px solid #0ff;
    border-radius: 16px;
    padding: 14px 18px;
    display: flex;
    flex-direction: column;
    justify-content: space-around;
    height: 90%;
    backdrop-filter: blur(6px);
    box-shadow: 0 0 12px rgba(0,255,255,0.2);
}

.value-glow:hover {
    text-shadow: 0 0 12px #0ff,
                 0 0 24px #0ff;
    transform: scale(1.05);
    transition: all 0.2s ease-in-out;
}
</style>

</head>

<body class="w-full h-full flex justify-center items-center">

<div id="wrap" class="carbon w-[1280px] h-[400px] rounded-3xl shadow-2xl relative border border-gray-800 flex">

    <!-- Left Info Boxes -->
    <div class="absolute left-4 top-2 bottom-2 flex flex-col justify-between side-box text-white">
        <div>
            <div class="text-gray-400 text-xs tracking-widest">OIL TEMP</div>
            <div id="oil" class="text-cyan-400 neon-text text-2xl font-bold value-glow">60°C</div>
        </div>
        <div>
            <div class="text-gray-400 text-xs tracking-widest">FUEL</div>
            <div id="fuel" class="text-cyan-400 neon-text text-2xl font-bold value-glow">73%</div>
        </div>
        <div>
            <div class="text-gray-400 text-xs tracking-widest">COOLANT</div>
            <div id="temp" class="text-cyan-400 neon-text text-2xl font-bold value-glow">20°C</div>
        </div>
    </div>

    <!-- Right Info Boxes -->
    <div class="absolute right-4 top-2 bottom-2 flex flex-col justify-between side-box text-white">
        <div>
            <div class="text-gray-400 text-xs tracking-widest">BATTERY</div>
            <div id="voltage" class="text-cyan-400 neon-text text-2xl font-bold value-glow">12.1V</div>
        </div>
        <div>
            <div class="text-gray-400 text-xs tracking-widest">BOOST</div>
            <div id="boost" class="text-cyan-400 neon-text text-2xl font-bold value-glow">1.1 bar</div>
        </div>
        <div>
            <div class="text-gray-400 text-xs tracking-widest">OIL PRESS</div>
            <div id="oilpress" class="text-cyan-400 neon-text text-2xl font-bold value-glow">0.3 bar</div>
        </div>
    </div>

    <!-- Canvas Gauge -->
    <canvas id="gauge" width="1280" height="400" class="absolute left-0 top-0"></canvas>

</div>

<script>
let speed=0, rpm=0;

// Canvas Setup
const c = document.getElementById("gauge");
const ctx = c.getContext("2d");
const cx=640, cy=390;
const rOuter=320;   
const rInner=250;   

const start=Math.PI*1.05, end=Math.PI*1.95;

// -----------------------------
// RPM SKALA (0-10000, 10 Einheiten)
// -----------------------------
function drawRpmScale() {
    ctx.save();
    ctx.lineWidth = 3;
    ctx.strokeStyle = "rgba(255,255,255,0.45)";
    ctx.fillStyle = "white";
    ctx.font = "17px Courier New";
    ctx.textAlign = "center";

    for (let i=0; i<=10; i++) {
        let a = start + (end-start)*(i/10);

        let x1 = cx + Math.cos(a)*(rOuter+15);
        let y1 = cy + Math.sin(a)*(rOuter+15);

        let x2 = cx + Math.cos(a)*(rOuter+40);
        let y2 = cy + Math.sin(a)*(rOuter+40);

        ctx.beginPath();
        ctx.moveTo(x1,y1);
        ctx.lineTo(x2,y2);
        ctx.stroke();

        ctx.fillText(i, cx + Math.cos(a)*(rOuter+50), cy + Math.sin(a)*(rOuter+50));
    }

    ctx.restore();
}

// -----------------------------
// SPEED SKALA
// -----------------------------
function drawSpeedScale() {
    ctx.save();
    ctx.lineWidth = 3;
    ctx.strokeStyle = "rgba(255,255,255,0.45)";
    ctx.fillStyle = "white";
    ctx.font = "16px Courier New";
    ctx.textAlign = "center";

    for (let i=0; i<=17; i++) {
        let p = i / 17;
        let a = start + (end-start)*p;
        let val = Math.round(p * 255);

        let x1 = cx + Math.cos(a)*(rInner+55);
        let y1 = cy + Math.sin(a)*(rInner+55);

        let x2 = cx + Math.cos(a)*(rInner+30);
        let y2 = cy + Math.sin(a)*(rInner+30);

        ctx.beginPath();
        ctx.moveTo(x1,y1);
        ctx.lineTo(x2,y2);
        ctx.stroke();

        ctx.fillText(val, cx + Math.cos(a)*(rInner + 11), cy + Math.sin(a)*(rInner + 11));
    }

    ctx.restore();
}

// -----------------------------
// Hauptanzeige
// -----------------------------
function drawGauge(){
    ctx.clearRect(0,0,c.width,c.height);

    drawRpmScale();
    drawSpeedScale();

    // Grauer Bogen
    ctx.beginPath();
    ctx.arc(cx, cy, rOuter, start, end);
    ctx.strokeStyle="rgba(140,140,160,0.2)";
    ctx.lineWidth=45;
    ctx.stroke();

    // RPM Balken mit Neon-Gradient + Glow
    let p = Math.min(rpm/8000,1);
    let rpmEnd = start + (end-start)*p;

    let grad = ctx.createLinearGradient(cx-rOuter, cy-rOuter, cx+rOuter, cy+rOuter);
    grad.addColorStop(0, "#ff00ff");
    grad.addColorStop(0.5, "#d64cff");
    grad.addColorStop(1, "#ff00ff");

    ctx.beginPath();
    ctx.arc(cx, cy, rOuter, start, rpmEnd);
    ctx.strokeStyle = grad;
    ctx.lineWidth = 45;
    ctx.shadowBlur = 25;
    ctx.shadowColor = "#d64cff";
    ctx.stroke();
    ctx.shadowBlur = 0;

    // Speed Zeiger
    let sp = Math.min(speed/255,1);
    let ang = start + (end-start)*sp;

    ctx.beginPath();
    ctx.moveTo(cx, cy);
    ctx.lineTo(cx + Math.cos(ang)*rInner, cy + Math.sin(ang)*rInner);
    ctx.strokeStyle="white";
    ctx.lineWidth=6;
    ctx.stroke();

    // Speed Zahl
    ctx.font = "small-caps 120px 'Verdana'";
    ctx.textAlign="center";
    ctx.textBaseline="middle";
    ctx.fillStyle="cyan";
    ctx.fillText(speed, cx, cy-140);
}

// -----------------------------
// Live Updates via Socket.IO
// -----------------------------
const socket = io();

socket.on('update', data => {
    if(data.RPM!==undefined) rpm = parseInt(data.RPM);
    if(data.SPEED!==undefined) speed = parseInt(data.SPEED);
    drawGauge();
});

// Initial anzeigen
drawGauge();
</script>

</body>
</html>

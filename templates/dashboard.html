<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8" />
<title>Racing Dashboard</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.socket.io/4.6.1/socket.io.min.js"></script>
<style>
/* Canvas bleibt individuell */
</style>
</head>
<body class="bg-black text-white overflow-hidden">
<div id="wrap" class="relative w-[1280px] h-[400px] mx-auto rounded-3xl overflow-hidden bg-gradient-to-b from-neutral-900 to-black shadow-2xl">
    <canvas id="gauge" width="1280" height="400"></canvas>

    <!-- LEFT BOX -->
    <div class="absolute left-6 top-10 w-56 h-80 flex flex-col justify-between p-4 backdrop-blur-sm bg-white/5 rounded-xl shadow-inner border border-white/10">
        <div>
            <div class="text-sm opacity-50">OIL TEMP</div>
            <div id="oil" class="text-2xl text-cyan-400 font-bold drop-shadow">60</div>
        </div>
        <div>
            <div class="text-sm opacity-50">FUEL</div>
            <div id="fuel" class="text-2xl text-cyan-400 font-bold drop-shadow">73%</div>
        </div>
        <div>
            <div class="text-sm opacity-50">COOLANT</div>
            <div id="temp" class="text-2xl text-cyan-400 font-bold drop-shadow">20C</div>
        </div>
    </div>

    <!-- RIGHT BOX -->
    <div class="absolute right-6 top-10 w-56 h-80 flex flex-col justify-between p-4 backdrop-blur-sm bg-white/5 rounded-xl shadow-inner border border-white/10">
        <div>
            <div class="text-sm opacity-50">BATTERY</div>
            <div id="voltage" class="text-2xl text-cyan-400 font-bold drop-shadow">11.8V</div>
        </div>
        <div>
            <div class="text-sm opacity-50">BOOST</div>
            <div id="boost" class="text-2xl text-cyan-400 font-bold drop-shadow">2 bar</div>
        </div>
        <div>
            <div class="text-sm opacity-50">OIL PRESS</div>
            <div id="oilpress" class="text-2xl text-cyan-400 font-bold drop-shadow">0.3 bar</div>
        </div>
    </div>
</div>

<script>
let speed=0, rpm=0, gear="N", temp=70;

const c = document.getElementById("gauge");
const ctx = c.getContext("2d");
const cx=640, cy=400, rOuter=360, rInner=300;
const start=Math.PI*1.1, end=Math.PI*1.9;

function drawGauge(){
    ctx.clearRect(0,0,c.width,c.height);

    ctx.beginPath();
    ctx.arc(cx, cy+50, rOuter, start, end);
    ctx.strokeStyle="rgba(100,100,100,0.3)";
    ctx.lineWidth=38;
    ctx.stroke();

    let rpmPercent = Math.min(rpm/10000,1);
    let rpmEnd = start + (end-start)*rpmPercent;
    ctx.beginPath();
    ctx.arc(cx, cy+50, rOuter, start, rpmEnd);
    ctx.strokeStyle="#d64cff";
    ctx.lineWidth=38;
    ctx.stroke();

    let sp = Math.min(speed/255,1);
    let ang = start + (end-start)*sp;
    ctx.beginPath();
    ctx.moveTo(cx, cy+60);
    ctx.lineTo(cx + Math.cos(ang)*rInner, cy + 60 + Math.sin(ang)*rInner);
    ctx.strokeStyle="white";
    ctx.lineWidth=4;
    ctx.stroke();

    ctx.font="120px 'Courier New'";
    ctx.textAlign="center";
    ctx.textBaseline="middle";
    ctx.fillStyle="cyan";
    ctx.fillText(speed, cx, cy-160);

    ctx.font="60px 'Courier New'";
    ctx.fillStyle="#d64cff";
    ctx.fillText(rpm, cx, cy-80);
}

const socket = io();

socket.on('update', data => {
    if(data.RPM!==undefined) rpm = parseInt(data.RPM);
    if(data.SPEED!==undefined) speed = parseInt(data.SPEED);
    if(data.COOLANT!==undefined) temp = parseInt(data.COOLANT);

    document.getElementById("temp").textContent = temp + "C";
    drawGauge();
});
drawGauge();
</script>
</body>
</html>
